<!DOCTYPE html><style>body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;margin:20px}.container{display:flex;flex-direction:column;gap:20px}.upload-row{display:flex;gap:20px}.upload-box{flex:1;border:2px dashed #ccc;padding:20px;text-align:center;min-height:120px;display:flex;flex-direction:column;justify-content:center;position:relative}.upload-box h3{margin:0 0 10px}input[type="file"]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.btn{background:#0052cc;color:#fff;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;margin:5px}.btn:disabled{background:#ccc}.error{color:#d00;background:#fee;padding:10px;border-radius:4px;display:none}.editor{display:none;border:1px solid #ddd;border-radius:4px}.editor-header{display:grid;grid-template-columns:1fr 1fr;background:#f5f5f5;padding:10px;border-bottom:1px solid #ddd}.translation-list{max-height:500px;overflow-y:auto}.translation-item{display:grid;grid-template-columns:1fr 1fr;padding:15px;border-bottom:1px solid #eee;gap:15px;align-items:start}.translation-item:nth-child(even){background:#fafafa}.source-text{padding:8px;border-left:3px solid #0052cc;background:#f0f7ff;border-radius:4px;white-space:pre-wrap;word-break:break-word}.translation-input{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;resize:vertical;font-family:inherit;min-height:40px;transition:height 0.2s}.translation-input:focus{outline:none;border-color:#0052cc;box-shadow:0 0 0 2px rgba(0,82,204,0.1)}.key-path{font-family:monospace;font-size:12px;color:#666;padding:8px;background:#f8f9fa;border-radius:4px}.array-indicator{color:#28a745;font-size:11px;margin-left:5px}.action-buttons{display:flex;gap:10px;justify-content:center;margin:20px 0}.status{text-align:center;padding:20px;color:#666}.file-info{font-size:12px;color:#666;margin-top:10px}</style><div class="container"><div class="upload-row"><div class="upload-box"><h3>Source JSON</h3><div>Click or drop JSON file</div><input type="file" id="sourceFile" accept=".json,application/json"><div class="file-info" id="sourceInfo"></div></div><div class="upload-box"><h3>Target JSON</h3><div>Click or drop JSON file</div><input type="file" id="targetFile" accept=".json,application/json"><div class="file-info" id="targetInfo"></div></div></div><div id="error" class="error"></div><div class="status" id="status">Load source and target JSON files to begin</div><div class="editor" id="editor"><div class="editor-header"><div>Source Text</div><div>Translation</div></div><div class="translation-list" id="translationList"></div><div class="action-buttons"><button class="btn" onclick="saveSource()">Save Source JSON</button><button class="btn" onclick="saveTarget()">Save Target JSON</button></div></div></div><script>
let sourceData=null,targetData=null,items=[],keyMap={}
let sourceFileName='source.json',targetFileName='translation.json'
document.getElementById('sourceFile').addEventListener('change',e=>handleFile(e,'source'))
document.getElementById('targetFile').addEventListener('change',e=>handleFile(e,'target'))
function handleFile(e,type){let file=e.target.files[0]
if(!file)return
let reader=new FileReader()
reader.onload=function(event){try{let text=event.target.result
let data=JSON.parse(text)
if(type==='source'){sourceData=data
keyMap=createKeyMap(sourceData)
sourceFileName=file.name
document.getElementById('sourceInfo').textContent=`${file.name} (${Object.keys(keyMap).length} items)`}else{targetData=data
targetFileName=file.name
document.getElementById('targetInfo').textContent=file.name}
document.getElementById('error').style.display='none'
checkStructure()}catch(err){showError(`Invalid JSON in ${type}: ${err.message}`)}}
reader.readAsText(file,'UTF-8')}
function createKeyMap(obj,path=''){let map={}
for(let k in obj){if(!obj.hasOwnProperty(k))continue
let cur=path?path+'.'+k:k
let val=obj[k]
if(val!==null&&typeof val==='object'){if(Array.isArray(val)){val.forEach((item,i)=>{let arrPath=cur+'['+i+']'
if(typeof item==='string'){map[arrPath]='string'}else if(item!==null&&typeof item==='object'){Object.assign(map,createKeyMap(item,arrPath))}})}else{Object.assign(map,createKeyMap(val,cur))}}else{map[cur]=typeof val}}
return map}
function checkStructure(){if(!sourceData||!targetData){document.getElementById('status').textContent=sourceData&&!targetData?'Load target JSON':'Load source JSON'
return}
let targetMap=createKeyMap(targetData)
let errors=[]
for(let k in keyMap){if(targetMap[k]&&keyMap[k]!==targetMap[k]){errors.push(`Type mismatch at "${k}": source is ${keyMap[k]}, target is ${targetMap[k]}`)}}
if(errors.length){showError(errors.join('<br>'))
return}
items=extractItems(sourceData)
renderEditor()}
function extractItems(obj,path=''){let result=[]
for(let k in obj){if(!obj.hasOwnProperty(k))continue
let cur=path?path+'.'+k:k
let val=obj[k]
if(val!==null&&typeof val==='object'){if(Array.isArray(val)){val.forEach((item,i)=>{let arrPath=cur+'['+i+']'
if(typeof item==='string'){result.push({path:arrPath,key:cur,value:item,type:'string',isArray:true,index:i})}else if(item!==null&&typeof item==='object'){result=result.concat(extractItems(item,arrPath))}})}else{result=result.concat(extractItems(val,cur))}}else{result.push({path:cur,key:cur,value:val,type:typeof val,isArray:false})}}
return result}
function getValue(obj,path){let parts=path.split(/[\.\[\]]+/).filter(p=>p!=='')
let cur=obj
for(let p of parts){if(cur===undefined||cur===null)return undefined
cur=cur[p]}
return cur}
function renderEditor(){let list=document.getElementById('translationList')
let html=''
items.forEach((item,i)=>{let targetVal=getValue(targetData,item.path)
if(item.type==='string'){html+=`<div class="translation-item"><div class="source-text">${escapeHtml(item.value)}${item.isArray?`<span class="array-indicator">[${item.index}]</span>`:''}<div class="key-path">${item.path}</div></div><textarea class="translation-input" data-path="${escapeHtml(item.path)}" placeholder="Translation..." oninput="updateTranslation(this,'${i}')">${targetVal!==undefined?escapeHtml(targetVal):''}</textarea></div>`}else{html+=`<div class="translation-item"><div class="source-text">${item.value}<div class="key-path">${item.path} (${item.type})</div></div><div style="padding:8px;color:#666;font-style:italic">Not editable - ${item.type}</div></div>`}})
list.innerHTML=html
document.getElementById('editor').style.display='block'
document.getElementById('status').style.display='none'
autoExpandTextareas()}
function updateTranslation(textarea,index){let path=textarea.getAttribute('data-path')
let value=textarea.value
setValue(targetData,path,value)
autoExpand(textarea)}
function setValue(obj,path,value){let parts=path.split(/[\.\[\]]+/).filter(p=>p!=='')
let cur=obj
for(let i=0;i<parts.length-1;i++){let p=parts[i]
if(cur[p]===undefined){cur[p]=/^\d+$/.test(parts[i+1])?[]:{}}cur=cur[p]}
if(parts.length>0){cur[parts[parts.length-1]]=value}}
function autoExpandTextareas(){document.querySelectorAll('.translation-input').forEach(t=>autoExpand(t))}
function autoExpand(t){t.style.height='auto'
t.style.height=(t.scrollHeight)+'px'}
function saveSource(){if(!sourceData){showError('No source data to save');return}
let jsonStr=JSON.stringify(sourceData,null,2)
let blob=new Blob(['\uFEFF'+jsonStr],{type:'application/json;charset=utf-8'})
let a=document.createElement('a')
a.href=URL.createObjectURL(blob)
a.download=sourceFileName
document.body.appendChild(a)
a.click()
document.body.removeChild(a)
URL.revokeObjectURL(a.href)}
function saveTarget(){if(!targetData){showError('No target data to save');return}
let jsonStr=JSON.stringify(targetData,null,2)
let blob=new Blob(['\uFEFF'+jsonStr],{type:'application/json;charset=utf-8'})
let a=document.createElement('a')
a.href=URL.createObjectURL(blob)
a.download=targetFileName
document.body.appendChild(a)
a.click()
document.body.removeChild(a)
URL.revokeObjectURL(a.href)}
function showError(msg){let e=document.getElementById('error')
e.innerHTML=msg
e.style.display='block'}
function escapeHtml(t){if(t===null||t===undefined)return''
return t.toString().replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
</script>